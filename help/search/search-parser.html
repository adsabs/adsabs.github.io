<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta
    name="google-site-verification"
    content="q68EGUOrG2HGZ62jIdD4ILfyPYZtDK6amNJbkrav_DA"
  />

  <!-- Disqus tags -->
  <meta property="og:image" content="">

  <link
    rel="stylesheet"
    href="/help/common/css/styles.css "
  />
  <link
    rel="apple-touch-icon"
    sizes="180x180"
    href="/help/common/images/apple-touch-icon.png"
  />
  <link
    rel="icon"
    type="image/png"
    sizes="32x32"
    href="/help/common/images/favicon-32x32.png"
  />
  <link
    rel="icon"
    type="image/png"
    sizes="16x16"
    href="/help/common/images/favicon-16x16.png"
  />
  <link
    rel="manifest"
    href="/help/common/images/manifest.json"
  />
  <link
    rel="mask-icon"
    href="/help/common/images/safari-pinned-tab.svg"
    color="#5bbad5"
  />
  <meta name="theme-color" content="#ffffff" />
  <link
    rel="canonical"
    href="https://ui.adsabs.harvard.edu/help/search/search-parser"
  />

  <link
    rel="stylesheet"
    href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.0/css/font-awesome.min.css"
  />
  <script>
    (function (i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      (i[r] =
        i[r] ||
        function () {
          (i[r].q = i[r].q || []).push(arguments);
        }),
        (i[r].l = 1 * new Date());
      (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m);
    })(
      window,
      document,
      'script',
      'https://www.google-analytics.com/analytics.js',
      'ga'
    );

    ga('create', 'UA-37369750-8', 'auto');
    ga('send', 'pageview');
  </script>
  <style>
    body {
      visibility: hidden;
      opacity: 0;
    }
  </style>
  <noscript>
    <style>
      body {
        visibility: visible;
        opacity: 1;
      }
    </style>
  </noscript>
  <meta http-equiv="Last-Modified" content="2022-02-03 21:58:32 +0000" />
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>(Advanced) Search Syntax | ADS news, blogs, and help pages</title>
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="(Advanced) Search Syntax" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The following page describes extra details about the search syntax not found in the otherwise comprehensive search syntax help." />
<meta property="og:description" content="The following page describes extra details about the search syntax not found in the otherwise comprehensive search syntax help." />
<link rel="canonical" href="https://ui.adsabs.harvard.edu/help/search/search-parser" />
<meta property="og:url" content="https://ui.adsabs.harvard.edu/help/search/search-parser" />
<meta property="og:site_name" content="ADS news, blogs, and help pages" />
<meta property="og:image" content="https://ui.adsabs.harvard.edu/help/common/images/transparent_logo.svg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-05-23T00:00:00+00:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://ui.adsabs.harvard.edu/help/common/images/transparent_logo.svg" />
<meta property="twitter:title" content="(Advanced) Search Syntax" />
<meta name="twitter:site" content="@adsabs" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-02-03T21:58:32+00:00","datePublished":"2021-05-23T00:00:00+00:00","description":"The following page describes extra details about the search syntax not found in the otherwise comprehensive search syntax help.","headline":"(Advanced) Search Syntax","image":"https://ui.adsabs.harvard.edu/help/common/images/transparent_logo.svg","mainEntityOfPage":{"@type":"WebPage","@id":"https://ui.adsabs.harvard.edu/help/search/search-parser"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ui.adsabs.harvard.edu/help/common/images/transparent_logo.svg"}},"url":"https://ui.adsabs.harvard.edu/help/search/search-parser"}</script>
<!-- End Jekyll SEO tag -->

</head>


  <body>
    <div>
  <nav class="navbar fluid navbar-inverse" aria-label="main navigation">
    <div class="navbar-header">
      <a class="navbar-brand s-navbar-brand" href="/help"
        ><img
          class="s-ads-icon"
          src="/help/common/images/transparent_logo.svg"
          alt="ads icon"
        />
        <b>&nbsp;ads</b>help
      </a>
    </div>

    <div class="navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav navbar-right">
        <li class="dropdown">
          <button
            type="button"
            class="btn btn-link dropdown-toggle"
            data-toggle="dropdown"
            aria-expanded="false"
          >
            <i
              class="fa fa-question-circle about-page-icon"
              aria-hidden="true"
            ></i>
            About <span class="caret"></span>
          </button>
          <ul class="dropdown-menu" role="menu">
            <li>
              <a href="/about/">
                <i class="fa fa-question-circle" aria-hidden="true"></i>
                About ADS
              </a>
            </li>
            <li>
              <a href="/help/whats_new/">
                <i class="fa fa-bullhorn" aria-hidden="true"></i>
                What's New
              </a>
            </li>
            <li>
              <a href="/blog/">
                <i class="fa fa-newspaper-o" aria-hidden="true"></i>
                ADS Blog
              </a>
            </li>
            <li>
              <a href="/help/">
                <i class="fa fa-info-circle" aria-hidden="true"></i>
                ADS Help Pages
              </a>
            </li>
            <li>
              <a href="/help/legacy/">
                <i class="fa fa-archive" aria-hidden="true"></i> ADS Legacy
                Services
              </a>
            </li>
            <li>
              <a href="/about/careers/">
                <i class="fa fa-group" aria-hidden="true"></i>
                Careers@ADS
              </a>
            </li>
          </ul>
        </li>
      </ul>
    </div>
  </nav>

  <div class="s-starry-background-wrapper">
    <section class="s-logo-header">
      <div>
        <a href="https://ui.adsabs.harvard.edu/">
          <img
            src="/help/common/images/transparent_logo.svg"
            alt="The Astrophysics Data System Logo"
          />
          <b>astrophysics</b>&nbsp;data system
        </a>
      </div>
    </section>
  </div>
</div>


    <div class="smart-container">
      <div class="search-bar-container pull-right col-xs-12 col-md-6">
        <script>
  (function () {
    var cx = '016381517138775266827:j_b8wqloe18';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>

      </div>
    </div>

    <div class="page-content smart-container"><div class="row row-offcanvas row-offcanvas-left">
  <div class="col-xs-6 col-sm-6 col-md-3 left-nav sidebar-offcanvas">
    <!--googleoff: all-->

<nav class="help-nav">

<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">

<div class="panel panel-default">
    <div class="panel-heading" role="tab" id="quickstart-help">
        <a class="collapsed" role="button" data-toggle="collapse" href="#quickstart-items" aria-expanded="false" aria-controls="collapseThree">
            <h3 class=""> <i class="fa fa-lg fa-caret-right"> </i>
    Quick Start</h3>
        <a>
    </div>
    <div id="quickstart-items" class="panel-collapse collapse" role="tabpanel" aria-labelledby="quickstart-help">
      <ul class="list-group">
              
            <a href="/help/quickstart/searching-for-paper">
                <li class=" list-group-item">Searching for a specific paper</li>
            </a>
              
            <a href="/help/quickstart/build-library">
                <li class=" list-group-item">Building a library and calculating metrics</li>
            </a>
              
            <a href="/help/quickstart/literature-search">
                <li class=" list-group-item">Beginning a literature search</li>
            </a>
              
            <a href="/help/quickstart/common-name">
                <li class=" list-group-item">Searching for papers by an author with a common name</li>
            </a>
             
        </ul>
    </div>
    </div>

  <div class="panel panel-default">
    <div class="panel-heading" role="tab" id="search-help">
        <a class="collapsed" role="button" data-toggle="collapse" href="#search-items" aria-expanded="false" aria-controls="collapseThree">
            <h3 class=""> <i class="fa fa-lg fa-caret-right"> </i> Making a Query</h3>
        <a>
    </div>
    <div id="search-items" class="panel-collapse collapse" role="tabpanel" aria-labelledby="search-help">
      <ul class="list-group">
              
            <a href="/help/search/search-syntax">
                <li class=" list-group-item">Search Syntax</li>
            </a>
              
            <a href="/help/search/citations-and-references">
                <li class=" list-group-item">Citation and Reference Operators</li>
            </a>
              
            <a href="/help/search/second-order">
                <li class=" list-group-item">Second-Order Queries</li>
            </a>
              
            <a href="/help/search/positional">
                <li class=" list-group-item">Positional Field Searches</li>
            </a>
              
            <a href="/help/search/filter">
                <li class=" list-group-item">Filter your search</li>
            </a>
              
            <a href="/help/search/comprehensive-solr-term-list">
                <li class=" list-group-item">Comprehensive List of Solr Fields & Operators</li>
            </a>
              
            <a href="/help/search/search-parser">
                <li class=" active  list-group-item">(Advanced) Search Syntax</li>
            </a>
              
            <a href="/help/search/author-search">
                <li class=" list-group-item">(Advanced) Author Search</li>
            </a>
             
        </ul>
    </div>
    </div>

<div class="panel panel-default">
  <div class="panel-heading" role="tab" id="actions-help">
      <a class="collapsed" role="button" data-toggle="collapse" href="#actions-items" aria-expanded="false" aria-controls="collapseThree">
          <h3 class=""><i class="fa fa-lg fa-caret-right"> </i> Search Results</h3>
      <a>
  </div>
  <div id="actions-items" class="panel-collapse collapse" role="tabpanel" aria-labelledby="actions-help">
    <ul class="list-group">
          
        <a href="/help/actions/sort">
            <li class=" list-group-item">Sort Results</li>
        </a>
          
        <a href="/help/actions/analyze">
            <li class=" list-group-item">Metrics</li>
        </a>
          
        <a href="/help/actions/export">
            <li class=" list-group-item">Export Results</li>
        </a>
          
        <a href="/help/actions/author-affiliation">
            <li class=" list-group-item">Author Affiliations</li>
        </a>
          
        <a href="/help/actions/visualize">
            <li class=" list-group-item">Visualize Results</li>
        </a>
          
        <a href="/help/actions/quick-links">
            <li class=" list-group-item">Quick Links</li>
        </a>
          
        <a href="/help/actions/article-view">
            <li class=" list-group-item">Article View</li>
        </a>
          
        <a href="/help/actions/bibcode">
            <li class=" list-group-item">ADS Bibcode</li>
        </a>
          
        <a href="/help/actions/journal-macros">
            <li class=" list-group-item">Journal Macros</li>
        </a>
         
      </ul>
    </div>
</div>

<div class="panel panel-default">
  <div class="panel-heading" role="tab" id="userpreferences-help">
      <a class="collapsed" role="button" data-toggle="collapse" href="#userpreferences-items" aria-expanded="false" aria-controls="collapseThree">
          <h3 class=""> <i class="fa fa-lg fa-caret-right"> </i> User Preferences</h3>
      <a>
  </div>
  <div id="userpreferences-items" class="panel-collapse collapse" role="tabpanel" aria-labelledby="userpreferences-help">
    <ul class="list-group">
          
        <a href="/help/userpreferences/library-servers">
            <li class=" list-group-item">Library Link Server</li>
        </a>
          
        <a href="/help/userpreferences/myads">
            <li class=" list-group-item">myADS Email Notifications</li>
        </a>
         
      </ul>
  </div>
</div>

<div class="panel panel-default">
  <div class="panel-heading" role="tab" id="libraries-help">
      <a class="collapsed" role="button" data-toggle="collapse"  href="#libraries-items" aria-expanded="false" aria-controls="collapseThree">
          <h3 class=""> <i class="fa fa-lg fa-caret-right"> </i> ADS Libraries</h3>
      <a>
  </div>
  <div id="libraries-items" class="panel-collapse collapse" role="tabpanel" aria-labelledby="libraries-help">
      <ul class="list-group">
            
          <a href="/help/libraries/creating-libraries">
              <li class=" list-group-item">Creating and editing a library</li>
          </a>
            
          <a href="/help/libraries/public-libraries">
              <li class=" list-group-item">Making your library public and managing permissions</li>
          </a>
            
          <a href="/help/libraries/visualisations">
              <li class=" list-group-item">Visualisations, metrics, and exports</li>
          </a>
            
          <a href="/help/libraries/citation-helper">
              <li class=" list-group-item">Citation Helper</li>
          </a>
            
          <a href="/help/libraries/set-operations">
              <li class=" list-group-item">Set operations</li>
          </a>
            
          <a href="/help/libraries/legacy-importing">
              <li class=" list-group-item">Import from ADS Classic</li>
          </a>
           
      </ul>
  </div>
</div>

<div class="panel panel-default">
  <div class="panel-heading" role="tab" id="orcid-help">
      <a class="collapsed" role="button" data-toggle="collapse"  href="#orcid-items" aria-expanded="false" aria-controls="collapseThree">
          <h3 class=""> <i class="fa fa-lg fa-caret-right"> </i> ORCID </h3>
      <a>
  </div>
  <div id="orcid-items" class="panel-collapse collapse" role="tabpanel" aria-labelledby="orcid-help">
      <ul class="list-group">
            
          <a href="/help/orcid/claiming-papers">
              <li class=" list-group-item">Claiming papers in ORCID</li>
          </a>
            
          <a href="/help/orcid/orcid-search">
              <li class=" list-group-item">Searching for papers in ORCID</li>
          </a>
           
      </ul>
  </div>
</div>

<div class="panel panel-default">
  <div class="panel-heading" role="tab" id="data_faq-help">
      <a class="collapsed" role="button" data-toggle="collapse"  href="#data_faq-items" aria-expanded="false" aria-controls="collapseThree">
          <h3 class=""> <i class="fa fa-lg fa-caret-right"> </i> Data & Curation </h3>
      <a>
  </div>
  <div id="data_faq-items" class="panel-collapse collapse" role="tabpanel" aria-labelledby="data_faq-help">
      <ul class="list-group">
            
          <a href="/help/data_faq/data-faq">
              <li class=" list-group-item">Data & Curation Frequently Asked Questions (FAQs)</li>
          </a>
            
          <a href="/help/data_faq/conf_proc">
              <li class=" list-group-item">Instructions to Conference Proceedings Editors</li>
          </a>
            
          <a href="/help/data_faq/tagged-format">
              <li class=" list-group-item">Submissions Formatting</li>
          </a>
            
          <a href="/help/data_faq/journal_inclusion">
              <li class=" list-group-item">Journal Inclusion</li>
          </a>
            
          <a href="/help/data_faq/ads_curation_model">
              <li class=" list-group-item">ADS Curation Model</li>
          </a>
            
          <a href="/help/data_faq/ScanHistLit">
              <li class=" list-group-item">Technical Standards for Scanning Legacy Literature</li>
          </a>
           
      </ul>
  </div>
</div>

  <div class="panel panel-default">
    <div class="panel-heading" role="tab" id="troubleshooting-help">
      <a class="collapsed" role="button" data-toggle="collapse"  href="#troubleshooting-items" aria-expanded="false" aria-controls="collapseThree">
        <h3 class=""> <i class="fa fa-lg fa-caret-right"> </i> Troubleshooting </h3>
        <a>
    </div>
    <div id="troubleshooting-items" class="panel-collapse collapse" role="tabpanel" aria-labelledby="tutorials-help">
      <ul class="list-group">
          
        <a href="/help/troubleshooting/exporting">
          <li class=" list-group-item">How to Export Results</li>
        </a>
          
        <a href="/help/troubleshooting/how-to-export-har-file">
          <li class=" list-group-item">How to Generate a HAR File</li>
        </a>
         
      </ul>
    </div>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading" role="tab" id="video-help">
      <a class="collapsed" role="button" data-toggle="collapse"  href="#videos-items" aria-expanded="false" aria-controls="collapseThree">
        <h3 class=""> <i class="fa fa-lg fa-caret-right"> </i> Videos </h3>
        <a>
    </div>
    <div id="videos-items" class="panel-collapse collapse" role="tabpanel" aria-labelledby="videos-help">
      <ul class="list-group">
          
        <a href="/help/videos/welcome">
          <li class=" list-group-item">Welcome to the New ADS</li>
        </a>
          
        <a href="/help/videos/intro">
          <li class=" list-group-item">Introduction to the New ADS</li>
        </a>
          
        <a href="/help/videos/personalization">
          <li class=" list-group-item">Personalization in the New ADS: ORCID and Libraries</li>
        </a>
          
        <a href="/help/videos/infrastructure">
          <li class=" list-group-item">Modernizing ADS Infrastructure: From 1992 to 2019</li>
        </a>
          
        <a href="/help/videos/affiliations">
          <li class=" list-group-item">Searching Affiliations in the New ADS</li>
        </a>
          
        <a href="/help/videos/advanced-search">
          <li class=" list-group-item">What are people thinking about what you want to think about?</li>
        </a>
          
        <a href="/help/videos/fulltext">
          <li class=" list-group-item">Searchable Full Text in the new ADS</li>
        </a>
          
        <a href="/help/videos/api">
          <li class=" list-group-item">Advanced Searching with the ADS API</li>
        </a>
          
        <a href="/help/videos/experts">
          <li class=" list-group-item">How to Use the ADS to Find Experts</li>
        </a>
          
        <a href="/help/videos/libraries">
          <li class=" list-group-item">Working with ADS Libraries</li>
        </a>
         
      </ul>
    </div>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading" role="tab" id="policies-help">
      <a class="collapsed" role="button" data-toggle="collapse"  href="#policies-items" aria-expanded="false" aria-controls="collapseThree">
        <h3 class=""> <i class="fa fa-lg fa-caret-right"> </i> Policies </h3>
      <a>
    </div>
    <div id="policies-items" class="panel-collapse collapse" role="tabpanel" aria-labelledby="policies-help">
      <ul class="list-group">
                                                                                                                                                                                                                                                              
          <a href="/help/policies/terms">
            <li class=" list-group-item">Terms of Use</li>
          </a>
                              
          <a href="/help/policies/privacy">
            <li class=" list-group-item">Privacy Policy</li>
          </a>
              
          <a href="/help/policies/accessibility">
            <li class=" list-group-item">Accessibility Policy</li>
          </a>
                            
          <a href="/help/policies/name-changes">
            <li class=" list-group-item">Name Change Policy</li>
          </a>
                      
          <a href="/help/policies/update">
            <li class=" list-group-item">ADS Update Policy</li>
          </a>
                                                   
      </ul>
    </div>
  </div>

</div>

    <h3 class=""> <a href="/help/whats_new">What's New</a></h3>
    <h3 class=""> <a href="/help/faq">Frequently Asked Questions </a></h3>
    <h3 class=""> <a href="/help/api">Using the ADS API </a></h3>
    <h3 class=""> <a href="/help/twitter">#ADSHelp</a></h3>
    <h3 class=""> <a href="/help/handouts">Handouts </a></h3>
    <h3 class=""> <a href="/help/legacy">Legacy Services </a></h3>
    <h3 class=""> <a href="/help/logos">Logos </a></h3>

    <hr>

    <h3 class><img src="/help/common/images/github.png" width="24"> Edit help pages on <a href="https://github.com/adsabs/help">GitHub</a></h3>


</nav>

<!--googleon: all-->

  </div>

  <div class="post main-content col-xs-12 col-md-9">
    <button
      class="btn btn-primary visible-sm-inline-block visible-xs-inline-block"
      data-toggle="off-canvas"
    >
      toggle sidebar
    </button>

    <header class="post-header">
      
      <h2 class="post-title">(Advanced) Search Syntax</h2>
      
    </header>

    <article class="post-content"><p>The following page describes extra details about the search syntax not found in the otherwise comprehensive <a href="search-syntax">search syntax help</a>.</p>

<h2 id="big-picture">Big Picture</h2>

<p>The search has two distinct phases:</p>

<ol>
  <li>building query</li>
  <li>executing query, collecting results</li>
</ol>

<p>The first phase is what we are going to discuss here. We’ll break it down further into:</p>

<ol>
  <li>parsing text into the AST (abstract syntax tree)</li>
  <li>modifying the query tree (semantic parsing)</li>
  <li>building the query object</li>
</ol>

<h2 id="parsing-text-into-ast">Parsing text into AST</h2>

<p>The <a href="https://github.com/romanchyla/montysolr/blob/master/contrib/adsabs/grammars/ADS.g">Search Grammar</a> defines the search language of ADS. It is a context-free grammar and it is used to generate a client library (<a href="https://www.antlr.org/">by ANTLR</a>).</p>

<p>If you don’t like reading context-free computer grammars (who does?) you’ll find a good explanation of ADS syntax here: <a href="search-syntax">search syntax help</a>.</p>

<p>But as a reward for having found this obscure corner of the help, we’ll illustrate a few more special situations not covered there.</p>

<h3 id="operators">Operators</h3>

<p>The search operators have the following precedence (from higher to lower priority): <code class="language-plaintext highlighter-rouge">NEARx -&gt; NOT -&gt; AND -&gt; OR -&gt; " "</code></p>

<p>Some details worth mentioning:</p>

<p><strong>Empty space is the default</strong></p>

<p>Better to illustrate it by way of examples:</p>

<p><code class="language-plaintext highlighter-rouge">jim and john not mary</code> becomes behind the scenes: <code class="language-plaintext highlighter-rouge">(jim AND (john NOT mary))</code> because <code class="language-plaintext highlighter-rouge">NOT</code> has precedence over <code class="language-plaintext highlighter-rouge">AND</code>. But <code class="language-plaintext highlighter-rouge">john jim and mary</code> becomes <code class="language-plaintext highlighter-rouge">(john AND (jim AND mary))</code> because <code class="language-plaintext highlighter-rouge">AND</code> operator has precedence over empty space (operator) – notice how <code class="language-plaintext highlighter-rouge">jim and mary</code> is evaluated as a group: i.e. the query is <strong>not</strong> parsed as <code class="language-plaintext highlighter-rouge">john AND jim AND mary</code>. That is a behaviour <strong>right now</strong> and the stress is on <strong>now</strong>; for the time being ADS search defaults to <code class="language-plaintext highlighter-rouge">AND</code> logic for the search operations. We are returning results that contain all the elements of the query. The reasons for this default behaviour are complex (and for the most part obsolete – more on that later). This behaviour can change in the future if ADS switches to a different default operator (<code class="language-plaintext highlighter-rouge">OR</code>) and makes sorting by relevancy the default sort order. Such a change would be (potentially highly) beneficial but would also change the order of how things get parsed. To make it clearer, if we ever change the default operator to (e.g.) <code class="language-plaintext highlighter-rouge">OR</code> - then <code class="language-plaintext highlighter-rouge">john jim and mary</code> will be evaluated as <code class="language-plaintext highlighter-rouge">(jim OR (john AND mary))</code></p>

<p><strong>You can modify the default operator</strong></p>

<p>It can also be changed on demand by adding <code class="language-plaintext highlighter-rouge">q.op=OR</code> into URL parameters (i.e. NOT inside the search form), in which case the logic will change dramatically. For any given query the results will contain many more records, but if sorted by relevancy score, the top items will be still the ones returned with the default <code class="language-plaintext highlighter-rouge">AND</code> operator.</p>

<p><strong>ADS supports proximity searches</strong></p>

<p>Yes, many people may not know about it, but you can do stuff like: <code class="language-plaintext highlighter-rouge">title:(dog NEAR5 cat)</code> – this will find any mention of the barking animal appearing up to 5 words (tokens) from the meowing animal. The <code class="language-plaintext highlighter-rouge">NEAR</code> has to be followed by a number [1-5] and it will not care about the order; i.e. <code class="language-plaintext highlighter-rouge">cat NEAR5 dog</code> == <code class="language-plaintext highlighter-rouge">dog NEAR5 cat</code> – this search can be very powerful, especially if applied against fulltext. It can also be quite expensive (computationally) - especially when the search term(s) have synonyms.</p>

<p><strong>There is no in-order proximity operator, but ADS still supports this feature</strong></p>

<p>ADS has a limited support for <strong>in-order proximity</strong> - if you make a phrase search like so <code class="language-plaintext highlighter-rouge">abs:"newtonian solar"~3</code> the word <code class="language-plaintext highlighter-rouge">newtonian</code> (and its synonyms) will have to be followed by <code class="language-plaintext highlighter-rouge">solar</code> (and its synonyms) for up to 3 positions away. We do not have a special operator for it though; if what you search for has more than 2 words, we’ll decide how far apart they can be. For example if you do <code class="language-plaintext highlighter-rouge">abs:"one two three"~3</code> then <code class="language-plaintext highlighter-rouge">one</code> may be 3 words away from <code class="language-plaintext highlighter-rouge">two three</code> (and it doesn’t matter that there are really 4 tokens between <code class="language-plaintext highlighter-rouge">one</code> and <code class="language-plaintext highlighter-rouge">three</code>).</p>

<h3 id="syntax-parsing">Syntax Parsing</h3>

<p>OK, so back to the syntactic parsing – how does it actually work? We have a formal grammar which describes the query language. Based on that, we have generated a library (in Java) which is included inside SOLR, our search engine. When SOLR receives the user input, before it can start searching for documents, the user query (string) will be turned into a query object. And that is the objective of the parser. First comes the syntactic phase during which an ANTLR parser will be ‘eating’ input character by character. It will occassionally veer off to explore a possible (alternative) branch, to either pursue it further or return back and start branching from some previous position. The input has to be syntactically correct; if we explored all possible readings and there are still some input characters left, it means the input is non-conforming and we’ll generate an exception and give up.</p>

<p>This is a feature, but it is borderline feature/bug. The syntax parser is <code class="language-plaintext highlighter-rouge">unforgiving</code> (that is the actual name of the class in Java). It would be possible (and the sensible thing to do) to actually first try to parse the input and on failure try again with some less unforgiving parser; but we have never gotten to it – so perhaps in the future… just know that if the parser encounters an error, it will generate an exception and the exception will actually say why/what has failed.</p>

<p>If the query is correct, however, after the parser is finished parsing, we’ll have the <strong>AST</strong> (Abstract Syntax Tree): a hierarchical datastructure (a tree) instead of the flat chain of characters.</p>

<p>Here an example (it is only an illustration, inside the search engine the AST will be richer):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"(this) (that)" 	-&gt;	
                            (DEFOP 
(CLAUSE (                               (CLAUSE (
    DEFOP (                                 DEFOP (
        MODIFIER (                              MODIFIER (
            TMODIFIER (                             TMODIFIER (
                FIELD (                                 FIELD (
                    QNORMAL this))))))                      QNORMAL that)))))))
</code></pre></div></div>

<p>In human words: the input <code class="language-plaintext highlighter-rouge">(this) (that)</code> has been parsed into an <code class="language-plaintext highlighter-rouge">AST</code>; the tree starts at a <code class="language-plaintext highlighter-rouge">DEFOP</code> node (default operator) which has two children (<code class="language-plaintext highlighter-rouge">CLAUSE</code>s). Each <code class="language-plaintext highlighter-rouge">CLAUSE</code> itself is made of a strict chain of components: <code class="language-plaintext highlighter-rouge">DEFOP-&gt;MODIFIER-&gt;TMODIFIER-&gt;FIELD</code> – they are all empty (with implicit value of none). It is only after we have arrived to a terminus <code class="language-plaintext highlighter-rouge">QNORMAL</code> that we also see values. Inside the tree, we will have information about every bracket, position, and links to parent/children.</p>

<p>This tree will be further modified in the next phase.</p>

<h3 id="semantic-parsing">Semantic Parsing</h3>

<p>There is a lot of magic that happens in this next phase. All of it is defined inside the <a href="https://github.com/romanchyla/montysolr/blob/master/contrib/adsabs/src/java/org/apache/lucene/queryparser/flexible/aqp/AqpAdsabsNodeProcessorPipeline.java">pipeline</a>.</p>

<p>Pro tip: if you add <code class="language-plaintext highlighter-rouge">debugQuery=true</code> to your search request URL parameters (and look at the data as returned by our API), you’ll see the serialized version of the query as parsed by SOLR. For example</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"debug":{
    "rawquerystring":"abs:\"newtonian solar\"~3",
    "querystring":"abs:\"newtonian solar\"~3",
    "parsedquery":"CustomScoreQuery(custom(abstract:\"syn::newton syn::solar\"~3 title:\"syn::newton syn::solar\"~3 keyword:\"syn::newton syn::solar\"~3, sum(float(cite_read_boost),const(0.5))))",
    "parsedquery_toString":"custom(abstract:\"syn::newton syn::solar\"~3 title:\"syn::newton syn::solar\"~3 keyword:\"syn::newton syn::solar\"~3, sum(float(cite_read_boost),const(0.5)))",
    ...
}
</code></pre></div></div>

<p>Pro tip (II): If you had access to STDOUT/logging of the SOLR instance, you would see LOTS of details; each and every step in the query pipeline produces output. This information is however only printed to STDOUT - and so only ADS engineers can really see it. Here is an example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> 57. step class org.apache.lucene.queryparser.flexible.standard.processors.MultiTermRewriteMethodProcessor
 Tree changed: NO

--------------------------------------------
 58. step class org.apache.lucene.queryparser.flexible.aqp.processors.AqpGroupQueryOptimizerProcessor
 Tree changed: YES
 Tags changed: YES
 -----------------
abstract:newtonian : {token_type_attribute=word, max_branch_size=2}
abstract:syn\:\:newton : {token_type_attribute=SYNONYM, max_branch_size=2}
abstract:solar : {token_type_attribute=word, max_branch_size=2}
abstract:syn\:\:solar : {token_type_attribute=SYNONYM, max_branch_size=2}
title:newtonian : {token_type_attribute=word, max_branch_size=2}
title:syn\:\:newton : {token_type_attribute=SYNONYM, max_branch_size=2}
title:solar : {token_type_attribute=word, max_branch_size=2}
title:syn\:\:solar : {token_type_attribute=SYNONYM, max_branch_size=2}
keyword:newtonian : {token_type_attribute=word, max_branch_size=2}
keyword:syn\:\:newton : {token_type_attribute=SYNONYM, max_branch_size=2}
keyword:solar : {token_type_attribute=word, max_branch_size=2}
keyword:syn\:\:solar : {token_type_attribute=SYNONYM, max_branch_size=2}
    -----------------
&lt;boolean operation='or'&gt;
&lt;slop value='4'&gt;
&lt;multiPhrase&gt;
&lt;field start='5' end='14' field='abstract' text='newtonian'/&gt;
&lt;field start='5' end='14' field='abstract' text='syn::newton'/&gt;
&lt;field start='15' end='20' field='abstract' text='solar'/&gt;
&lt;field start='15' end='20' field='abstract' text='syn::solar'/&gt;
&lt;/multiPhrase&gt;
&lt;/slop&gt;
&lt;slop value='4'&gt;
&lt;multiPhrase&gt;
&lt;field start='5' end='14' field='title' text='newtonian'/&gt;
&lt;field start='5' end='14' field='title' text='syn::newton'/&gt;
&lt;field start='15' end='20' field='title' text='solar'/&gt;
&lt;field start='15' end='20' field='title' text='syn::solar'/&gt;
&lt;/multiPhrase&gt;
&lt;/slop&gt;
&lt;slop value='4'&gt;
&lt;multiPhrase&gt;
&lt;field start='5' end='14' field='keyword' text='newtonian'/&gt;
&lt;field start='5' end='14' field='keyword' text='syn::newton'/&gt;
&lt;field start='15' end='20' field='keyword' text='solar'/&gt;
&lt;field start='15' end='20' field='keyword' text='syn::solar'/&gt;
&lt;/multiPhrase&gt;
&lt;/slop&gt;
&lt;/boolean&gt;
--------------------------------------------
 59. step class org.apache.lucene.queryparser.flexible.aqp.processors.AqpOptimizationProcessor
 Tree changed: NO
</code></pre></div></div>

<p>There are over 60 steps inside the pipeline, some of them extremely complex (see for example <a href="author-search">author search</a>) and some simple. We cannot describe here everything that happens there; but we should point out that the pipeline is like a chain of transducers. Each component will see the <code class="language-plaintext highlighter-rouge">AST</code>, it will modify it and then processing switches to the next component. There are pre- and post- stages; which would correspond to in-order and post-order traversal of the tree. And in some situations the parser will invoke itself, so it is like a coiled snake eating its own tail – is it messy? Perhaps, but we’d add that it is only as messy as it needs to be. The work done by the parser is extremely important, it is a complicated job of transforming, extending, cutting, slicing and re-constructing the query. It is complicated because it has to be, but it is also very powerful. And it keeps evolving with ADS users and their requests.</p>

<h2 id="building-the-query-object">Building the Query Object</h2>

<p>Once every component has finished modifying the AST, we had pruned the tree into almost a flat list of parent/child relationships. At the end of those 60 transducers, we have a much lighter AST. This object is passed to <a href="https://github.com/romanchyla/montysolr/blob/master/contrib/adsabs/src/java/org/apache/lucene/queryparser/flexible/aqp/AqpAdsabsQueryTreeBuilder.java"><code class="language-plaintext highlighter-rouge">query builders</code></a>. Their job is to turn this modified semantic tree into <strong>query objects</strong> as understood by Lucene/SOLR. That <code class="language-plaintext highlighter-rouge">Query</code> object is then responsible for selecting <strong>and</strong> scoring documents based on the users input and the query parameters that came with it or were presented by default.</p>

<p>The majority of those query objects are typical Lucene/SOLR citizens such as <code class="language-plaintext highlighter-rouge">BooleanQuery</code>, <code class="language-plaintext highlighter-rouge">TermQuery</code>. During the life of ADS a few more (specialized) categories have been added, e.g:</p>

<ul>
  <li>BitSetQuery: allows ADS users to select documents based on the list of IDs (this supports a very large number of identifiers; millions of them)</li>
  <li><a href="second-order">SecondOrderQuery</a></li>
</ul>

<h2 id="special-parameters-affecting-search">Special Parameters Affecting Search</h2>

<p>There is a plethora of options that will affect how the search is executed, many of them are described directly in the <a href="https://solr.apache.org/guide/7_3/common-query-parameters.html">SOLR documentation</a>.</p>

<p>Here are some ADS specific ones that can be changed:</p>

<h3 id="aqpunfieldedtokensstrategy">aqp.unfielded.tokens.strategy</h3>

<p>Possible values: tag, join, add, multiply, <strong>disjuncts</strong></p>

<p>This controls how we are going to generate additional queries for an unfielded search (i.e. search which omits index field information such as <code class="language-plaintext highlighter-rouge">author:huchra nasa</code>)</p>

<p>Our parser is not smart (slow) enough to see that <code class="language-plaintext highlighter-rouge">nasa</code> is not a name, so encountering this <code class="language-plaintext highlighter-rouge">unfielded</code> part of the query, it can do the following under these circumstances:</p>

<ul>
  <li>tag: produces no query changes, but the unfielded tokens can be seen/used by other components to generate/modify query object</li>
  <li>join: will join the unfielded portion of the query to its prefix effectively saying <code class="language-plaintext highlighter-rouge">author:"huchra nasa"</code> (especially when <strong>aqp.unfielded.tokens.new.type</strong> is phrase)</li>
  <li>add: will construct an additional query with the ambiguous part of the query being searched separately, e.g. (<code class="language-plaintext highlighter-rouge">author:"huchra nasa"</code> OR <code class="language-plaintext highlighter-rouge">+author:huchra +nasa)</code></li>
  <li>multiply: this is very similar to the <code class="language-plaintext highlighter-rouge">add</code> strategy but the difference is in how the resulting query gets parsed; here we are not constructing query objects directly but instead we’ll re-parse the newly constructed query from the string up and therefore we can apply the whole query parsing/building logic to just a portion of the query; the new parser will start from analyzing <code class="language-plaintext highlighter-rouge">author:huchra nasa author:\"huchra nasa\"</code></li>
  <li>disjuncts: our default, this is like the <code class="language-plaintext highlighter-rouge">multiply</code> strategy but instead of adding OR clauses, we will generate a disjunct query which affects scoring. Only the highest scoring portion of the query affects the final score, thus if we programmatically added something to the user’s input or not, it will not artifically inflate the final score</li>
</ul>

<h3 id="aqpunfieldedtokensnewtype">aqp.unfielded.tokens.new.type</h3>

<p>Can be combined with the parameter above; affects what happens to the identified unfielded portion of the query.</p>

<ul>
  <li>simple: our default, tokens are joined together by a white space</li>
  <li>phrase: AST tokens are joined together to produce a phrase AST</li>
  <li>normal: AST tokens are joined together into an AST group (as if the user typed: <code class="language-plaintext highlighter-rouge">(foo bar baz)</code> - i.e. with explicit quotes)</li>
</ul>

<h3 id="aqpunfieldedtokensfunctionname">aqp.unfielded.tokens.function.name</h3>

<p>A function that will be used to reparse the unfielded portion of the query; only applicable for <code class="language-plaintext highlighter-rouge">multiply</code> and <code class="language-plaintext highlighter-rouge">disjuncts</code> strategies. For the list of available functions/operators, see: <a href="https://github.com/romanchyla/montysolr/blob/master/contrib/adsabs/src/java/org/apache/lucene/queryparser/flexible/aqp/builders/AqpAdsabsSubQueryProvider.java">query functions</a>. The default is <code class="language-plaintext highlighter-rouge">edismax_combined_aqp</code>.</p>

<h3 id="aqpdefaultoperator">aqp.defaultOperator</h3>

<p>By default, ADS will search using the <code class="language-plaintext highlighter-rouge">AND</code> operator when two search terms are joined only by a space. But if modified (the only sensible option is probably <code class="language-plaintext highlighter-rouge">OR</code>) then this will make the search engine evaluate every search parameter as ‘nice to have’. This is actually better than it sounds, because when sorting search results by score, they will come back ordered by relevancy score (which is the secret sauce that changes so it cannot be described; but users might find the relevancy score to be much better than the ADS defaults).</p>

<h3 id="aqpunfieldedsearch">aqp.unfieldedSearch</h3>

<p>By default, this is the list of fields, with their weights, that get searched when no field is specified: <code class="language-plaintext highlighter-rouge">author^1.5 title^1.4 abstract^1.3</code> – obviously, one could modify this using a URL parameter.</p>

<h3 id="aqpforcefuzzyphrases">aqp.force.fuzzy.phrases</h3>

<p><code class="language-plaintext highlighter-rouge">author,first_author,book_author,editor</code> – these fields, when searched as “some other”~2, will be searched using fuzzy logic.</p>
</article>
  </div>
</div>
</div>

    <footer>
  <div class="__footer_wrapper">
    <div class="__footer_brand">
      &copy; The SAO Astrophysics Data System
      <div class="__footer_brand_extra">
        <p>
          <i class="fa fa-envelope" aria-hidden="true"></i>
          adshelp[at]cfa.harvard.edu
        </p>
        <p>
          The ADS is operated by the Smithsonian Astrophysical Observatory under
          NASA Cooperative Agreement <em>80NSSC21M0056</em>
        </p>
      </div>
      <div class="__footer_brand_logos">
        <a href="http://www.si.edu" target="_blank" rel="noreferrer noopener">
          <img
            id="smithsonian-logo"
            src="/help/common/images/smithsonian.svg"
            alt="Smithsonian logo"
          />
        </a>
        <a
          href="https://www.cfa.harvard.edu/"
          target="_blank"
          rel="noreferrer noopener"
        >
          <img
            src="/help/common/images/cfa.png"
            alt="Harvard Center for Astrophysics logo"
            id="cfa-logo"
          />
        </a>
        <a href="http://www.nasa.gov" target="_blank" rel="noreferrer noopener">
          <img
            src="/help/common/images/nasa-partner.svg"
            alt="NASA logo"
            id="nasa-logo"
          />
        </a>
      </div>
      <div class="footer-disclaimer">
        *The material contained in this document is based upon work supported by
        a National Aeronautics and Space Administration (NASA) grant or
        cooperative agreement. Any opinions, findings, conclusions or
        recommendations expressed in this material are those of the author and
        do not necessarily reflect the views of NASA.
      </div>
    </div>
    <div class="__footer_list">
      <div class="__footer_list_title">Resources</div>
      <ul class="__footer_links">
        <li>
          <a href="/about/">
            <i class="fa fa-question-circle" aria-hidden="true"></i> About ADS
          </a>
        </li>
        <li>
          <a href="/help/">
            <i class="fa fa-info-circle" aria-hidden="true"></i> ADS Help
          </a>
        </li>
        <li>
          <a href="/help/whats_new/">
            <i class="fa fa-bullhorn" aria-hidden="true"></i> What's New
          </a>
        </li>
        <li>
          <a href="/about/careers/">
            <i class="fa fa-group" aria-hidden="true"></i> Careers@ADS
          </a>
        </li>
        <li>
          <a href="/help/accessibility/">
            <i class="fa fa-universal-access" aria-hidden="true"></i>
            Accessibility
          </a>
        </li>
      </ul>
    </div>
    <div class="__footer_list">
      <div class="__footer_list_title">Social</div>
      <ul class="__footer_links">
        <li>
          <a
            href="//twitter.com/adsabs"
            target="_blank"
            rel="noreferrer noopener"
          >
            <i class="fa fa-twitter" aria-hidden="true"></i> @adsabs
          </a>
        </li>
        <li>
          <a href="/blog/">
            <i class="fa fa-newspaper-o" aria-hidden="true"></i> ADS Blog
          </a>
        </li>
      </ul>
    </div>
    <div class="__footer_list">
      <div class="__footer_list_title">Project</div>
      <ul class="__footer_links">
        <li>
          <a href="/core">Switch to basic HTML</a>
        </li>
        <li>
          <a href="/help/privacy/">Privacy Policy</a>
        </li>
        <li>
          <a href="/help/terms">Terms of Use</a>
        </li>
        <li>
          <a
            href="http://www.cfa.harvard.edu/sao"
            target="_blank"
            rel="noreferrer noopener"
            >Smithsonian Astrophysical Observatory</a
          >
        </li>
        <li>
          <a href="http://www.si.edu" target="_blank" rel="noreferrer noopener"
            >Smithsonian Institution</a
          >
        </li>
        <li>
          <a
            href="http://www.nasa.gov"
            target="_blank"
            rel="noreferrer noopener"
            >NASA</a
          >
        </li>
      </ul>
    </div>
  </div>
</footer>


    <div id="darkSwitch" class="darkmode-toggle" title="Turn on dark mode">
      🌓
    </div>
    <script src="/help/common/js/dark-mode-switch.js"></script>
  </body>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.js"></script>
  <script
    src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"
    integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS"
    crossorigin="anonymous"
  ></script>

  <script>
    $(document).ready(function () {
      $('body').on('click', 'button[data-toggle="off-canvas"]', function () {
        $('.row-offcanvas').toggleClass('active');
      });
    });
  </script>

  <!-- for sidebar -->
  <script>
    $(document).ready(function () {
      //ADD THE PROPER HIGHLIGHT
      try {
        var category = window.location.pathname.split('/')[2];
      } catch (e) {
        console.error("couldn't parse category name");
      }
      //this should fail without causing a problem if category can't be found
      if ($('.help-nav').find('div#' + category + '-items').length === 0)
        console.log('couldnt find accordion drawer for: ', category);
      $('.help-nav')
        .find('div#' + category + '-items')
        .addClass('in')
        //set the caret pointing down
        .parent()
        .find('.fa')
        .removeClass('fa-caret-right')
        .addClass('fa-caret-down');

      //SET LISTENERS FOR CARET OPEN/CLOSED
      $('.help-nav .collapse')
        .on('show.bs.collapse', function () {
          $(this)
            .parent()
            .find('.fa')
            .removeClass('fa-caret-right')
            .addClass('fa-caret-down');
        })
        .on('hide.bs.collapse', function () {
          $(this)
            .parent()
            .find('.fa')
            .removeClass('fa-caret-down')
            .addClass('fa-caret-right');
        });
    });
  </script>

  <script>
    (function (i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      (i[r] =
        i[r] ||
        function () {
          (i[r].q = i[r].q || []).push(arguments);
        }),
        (i[r].l = 1 * new Date());
      (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m);
    })(
      window,
      document,
      'script',
      '//www.google-analytics.com/analytics.js',
      'ga'
    );

    ga('create', 'UA-37369750-8', 'auto');
    ga('send', 'pageview');
  </script>
</html>
